# Upstreams (localhost-only)
OLLAMA_BASE_URL=http://127.0.0.1:11434
MLX_BASE_URL=http://127.0.0.1:10240/v1

# Gateway listen
GATEWAY_HOST=0.0.0.0
GATEWAY_PORT=8800

# Auth (required). Generate a long random token.
GATEWAY_BEARER_TOKEN=682c0b0ea47eaf458d944df4853424a13012d61594d47200f3343cbdb341d461

# Optional: accept multiple bearer tokens (comma-separated). If set, any token in the list is accepted.
# If empty, gateway falls back to single-token GATEWAY_BEARER_TOKEN.
# GATEWAY_BEARER_TOKENS=token_for_you,token_for_associate
GATEWAY_BEARER_TOKENS=

# Optional: per-token policy JSON (single-line JSON). Keys are bearer tokens.
# Supported keys (best-effort):
#   - tools_allowlist: "noop,http_fetch" (overrides all other tool toggles for that token)
#   - tools_allow_shell/tools_allow_fs/tools_allow_http_fetch/tools_allow_git: true|false
#   - tools_allow_system_info/tools_allow_models_refresh: true|false
#   - tools_rate_limit_rps/tools_rate_limit_burst
#   - max_request_bytes: integer (overrides MAX_REQUEST_BYTES for that token)
#   - ip_allowlist: "127.0.0.1,10.0.0.0/8" (overrides IP_ALLOWLIST for that token)
# Example:
# GATEWAY_TOKEN_POLICIES_JSON={"token_for_associate":{"tools_allowlist":"noop,http_fetch_local","tools_rate_limit_rps":2,"tools_rate_limit_burst":4}}
GATEWAY_TOKEN_POLICIES_JSON=

# Optional request guardrails
# MAX_REQUEST_BYTES=0 disables. When enabled, requests exceeding this size return 413.
MAX_REQUEST_BYTES=1000000

# Optional: allow only specific client IPs/CIDRs (comma-separated). Empty allows all.
# IP_ALLOWLIST=127.0.0.1,10.0.0.0/8
IP_ALLOWLIST=

# Routing policy
DEFAULT_BACKEND=ollama   # ollama|mlx
OLLAMA_MODEL_DEFAULT=qwen2.5:32b
MLX_MODEL_DEFAULT=mlx-community/gemma-2-2b-it-8bit

# Tooling (gateway-level)
TOOLS_ALLOW_SHELL=true
TOOLS_ALLOW_FS=true
TOOLS_SHELL_CWD=/var/lib/gateway/tools
TOOLS_SHELL_TIMEOUT_SEC=20

# Optional: safe built-in tools
TOOLS_ALLOW_SYSTEM_INFO=false
TOOLS_ALLOW_MODELS_REFRESH=false

# Tool bus JSONL log
TOOLS_LOG_PATH=/var/lib/gateway/data/tools/invocations.jsonl

# Tool bus logging mode:
# - ndjson: append-only JSONL at TOOLS_LOG_PATH
# - per_invocation: one JSON file per replay_id under TOOLS_LOG_DIR
# - both: do both
TOOLS_LOG_MODE=ndjson
TOOLS_LOG_DIR=/var/lib/gateway/data/tools

# Optional: explicit tool registry (versioned tool declarations executed via subprocess).
# See services/gateway/env/tools_registry.json.example
TOOLS_REGISTRY_PATH=/var/lib/gateway/app/tools_registry.json

# Optional: registry integrity check (sha256 hex). If set and mismatched, registry is ignored.
TOOLS_REGISTRY_SHA256=

# Tool execution hard limits
TOOLS_MAX_CONCURRENT=8
TOOLS_CONCURRENCY_TIMEOUT_SEC=5
TOOLS_SUBPROCESS_STDOUT_MAX_CHARS=20000
TOOLS_SUBPROCESS_STDERR_MAX_CHARS=20000

# Optional: per-bearer-token rate limiting for /v1/tools endpoints (disabled when <= 0).
TOOLS_RATE_LIMIT_RPS=0
TOOLS_RATE_LIMIT_BURST=0

# Optional: metrics endpoint
METRICS_ENABLED=true

# Embeddings
EMBEDDINGS_BACKEND=ollama   # ollama|mlx
EMBEDDINGS_MODEL=nomic-embed-text

# Memory
MEMORY_ENABLED=true
MEMORY_DB_PATH=/var/lib/gateway/data/memory.sqlite
MEMORY_TOP_K=6
MEMORY_MIN_SIM=0.25
MEMORY_MAX_CHARS=6000

# Minimal request instrumentation (JSONL)
REQUEST_LOG_ENABLED=true
REQUEST_LOG_PATH=/var/lib/gateway/data/requests.jsonl

